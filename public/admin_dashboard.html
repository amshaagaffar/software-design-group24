<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="Styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  
</head>

<body>

<header>
  <nav>
    <div class="logo">
      Hands2Help
    </div>

    <div class="menu-container">
    <div class="menu">
      <a href="admin_dashboard.html">Dashboard</a>
      <a href="userprofileview.html">Account</a>
    </div>

    <button class="noti" id="notification-button">
      <img src="resources/notification-newdot-line.svg" alt="Notification" class="noti-button">
  </button>


      <button id="signout-button" onclick="signOut()" class="signout-button">Sign Out</button>
</div>
  </nav>
</header>
<div class="dashboard-content">
  <div class="dash-header">
    <h1>Welcome to your Dashboard!</h1>
    <p id="user-email" class="user-email"><!-- Placeholder for user email --></p>
  </div>

  <div class="dashboard-navigation">
    <ul>
      <li><a href="#" onclick="loadSection('Events.html')">Event Management</a></li>
      <li><a href="#" onclick="loadSection('volunteermatch.html')">Volunteer Matching</a></li>
      <li><a href="#" onclick="loadSection('volunteerhistory.html')">Volunteer History</a></li>
    </ul>
  </div>

  <div id="section-container" class="section-container">
    <!-- Content will be loaded here -->
  </div>
</div>

<!-- JavaScript -->
<script>
  // Get user info from JWT token
  function getUserInfo() {
    const token = localStorage.getItem('token'); // Get token from localStorage
    if (token) {
      const payload = JSON.parse(atob(token.split('.')[1])); // Decode the JWT payload
      const now = Date.now() / 1000; // Current time in seconds

      // Check if the token is expired
      if (payload.exp > now) {
        return { email: payload.email, role: payload.role }; // Return email and role if valid
      } else {
        localStorage.removeItem('token'); // Remove expired token
        alert('Your session has expired. Please log in again.');
        window.location.href = 'Login.html'; // Redirect to login page
      }
    }
    return null; // Return null if no token is found
  }

  // Display user email on the dashboard
  const userInfo = getUserInfo();
  if (userInfo) {
    document.getElementById('user-email').textContent = 'Your Email: ' + userInfo.email; // Display email
  } else {
    document.getElementById('user-email').textContent = 'You are not logged in.';
    window.location.href = 'Login.html'; // Redirect to login page if not logged in
  }

  // Sign out function
  function signOut() {
    localStorage.removeItem('token'); // Remove token from localStorage
    alert('You have been signed out.');
    window.location.href = 'Login.html'; // Redirect to login page
  }

  // Load sections dynamically
  function loadSection(fileName) {
    // Fetch the external HTML file content
    fetch(fileName)
            .then(response => response.text())
            .then(data => {
              // Insert the content into the container
              document.getElementById('section-container').innerHTML = data;

              // Call function to fetch volunteer history if loading the volunteer history section
              if (fileName === 'volunteerhistory.html') {
                fetchVolunteerHistory();
              }
            })
            .catch(error => console.log('Error loading section', error));
  }

  // Function to fetch volunteer history
  function fetchVolunteerHistory() {
    const token = localStorage.getItem('token');
    if (!token) {
      alert('You are not authenticated. Please log in.');
      window.location.href = 'Login.html'; // Redirect to login if no token
      return;
    }

    fetch('/volunteerhistory', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.message) {
                alert(data.message);
                return;
              }

              const tbody = document.getElementById("volunteer-history");
              data.forEach(event => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${event.eventName}</td>
                    <td>${event.eventDescription}</td>
                    <td>${event.location}</td>
                    <td>${event.requiredSkills.join(", ")}</td>
                    <td>${event.urgency}</td>
                    <td>${event.eventDate}</td>
                    <td>${event.participationStatus}</td>
                `;
                tbody.appendChild(row);
              });
            })
            .catch(error => console.error('Error:', error));
  }

  document.addEventListener('DOMContentLoaded', function() {
    // No default section to load on page load
  });
</script>

<script>
  // Create a variable to track whether notifications are shown
  let notificationsVisible = false;

  // Event listener for the notification button
  document.getElementById('notification-button').addEventListener('click', function () {
    notificationsVisible = !notificationsVisible;
    // Show or hide notifications based on the current state
    // (The implementation for showing/hiding notifications is assumed to be elsewhere in your code)
    alert(notificationsVisible ? 'Notifications Shown' : 'Notifications Hidden');
  });
</script>
</body>
</html>